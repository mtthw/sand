{"ts":1361844984434,"silentsave":true,"restoring":false,"patch":[[{"diffs":[[1,"// Generated by CoffeeScript 1.4.0\r\nvar Heyoffline, addEvent, destroy, extend, setStyles,\r\n  __bind = function(fn, me){ return function(){ return fn.apply(me, arguments); }; };\r\n\r\nextend = function(destination, source) {\r\n  var property;\r\n  if (source) {\r\n    for (property in source) {\r\n      if (source[property] && source[property].constructor && source[property].constructor === Object) {\r\n        destination[property] = destination[property] || {};\r\n        arguments.callee(destination[property], source[property]);\r\n      } else {\r\n        destination[property] = source[property];\r\n      }\r\n    }\r\n  }\r\n  return destination;\r\n};\r\n\r\naddEvent = function(element, event, fn, useCapture) {\r\n  if (useCapture == null) {\r\n    useCapture = false;\r\n  }\r\n  return element.addEventListener(event, fn, useCapture);\r\n};\r\n\r\nsetStyles = function(element, styles) {\r\n  var key, _results;\r\n  _results = [];\r\n  for (key in styles) {\r\n    _results.push(element.style[key] = styles[key]);\r\n  }\r\n  return _results;\r\n};\r\n\r\ndestroy = function(element) {\r\n  return element.parentNode.removeChild(element);\r\n};\r\n\r\nHeyoffline = (function() {\r\n\r\n  Heyoffline.prototype.options = {\r\n    text: {\r\n      title: \"You're currently offline\",\r\n      content: \"Seems like you've gone offline,                you might want to wait until your network comes back before continuing.<br /><br />                This message will self-destruct once you're online again.\",\r\n      button: \"Relax, I know what I'm doing\"\r\n    },\r\n    monitorFields: false,\r\n    prefix: 'heyoffline',\r\n    noStyles: false,\r\n    disableDismiss: false,\r\n    elements: ['input', 'select', 'textarea', '*[contenteditable]']\r\n  };\r\n\r\n  Heyoffline.prototype.modified = false;\r\n\r\n  function Heyoffline(options) {\r\n    this.hideMessage = __bind(this.hideMessage, this);\r\n\r\n    this.offline = __bind(this.offline, this);\r\n\r\n    this.online = __bind(this.online, this);\r\n    extend(this.options, options);\r\n    this.setup();\r\n  }\r\n\r\n  Heyoffline.prototype.setup = function() {\r\n    this.events = {\r\n      element: ['keyup', 'change'],\r\n      network: ['online', 'offline']\r\n    };\r\n    this.elements = {\r\n      fields: document.querySelectorAll(this.options.elements.join(',')),\r\n      overlay: document.createElement('div'),\r\n      modal: document.createElement('div'),\r\n      heading: document.createElement('h2'),\r\n      content: document.createElement('p'),\r\n      button: document.createElement('a')\r\n    };\r\n    this.defaultStyles = {\r\n      overlay: {\r\n        position: 'absolute',\r\n        top: 0,\r\n        left: 0,\r\n        width: '100%',\r\n        background: 'rgba(0, 0, 0, 0.3)',\r\n        zIndex: 500\r\n      },\r\n      modal: {\r\n        padding: '15px',\r\n        background: '#fff',\r\n        boxShadow: '0 2px 30px rgba(0, 0, 0, 0.3)',\r\n        width: '450px',\r\n        margin: '0 auto',\r\n        position: 'relative',\r\n        top: '30%',\r\n        color: '#444',\r\n        borderRadius: '2px',\r\n        zIndex: 600\r\n      },\r\n      heading: {\r\n        fontSize: '1.7em',\r\n        paddingBottom: '15px'\r\n      },\r\n      content: {\r\n        paddingBottom: '15px'\r\n      },\r\n      button: {\r\n        fontWeight: 'bold',\r\n        cursor: 'pointer'\r\n      }\r\n    };\r\n    return this.attachEvents();\r\n  };\r\n\r\n  Heyoffline.prototype.createElements = function() {\r\n    this.createElement(document.body, 'overlay');\r\n    this.resizeOverlay();\r\n    this.createElement(this.elements.overlay, 'modal');\r\n    this.createElement(this.elements.modal, 'heading', this.options.text.title);\r\n    this.createElement(this.elements.modal, 'content', this.options.text.content);\r\n    if (!this.options.disableDismiss) {\r\n      this.createElement(this.elements.modal, 'button', this.options.text.button);\r\n      return addEvent(this.elements.button, 'click', this.hideMessage);\r\n    }\r\n  };\r\n\r\n  Heyoffline.prototype.createElement = function(context, element, text) {\r\n    this.elements[element].setAttribute('class', \"\" + this.options.prefix + \"_\" + element);\r\n    this.elements[element] = context.appendChild(this.elements[element]);\r\n    if (text) {\r\n      this.elements[element].innerHTML = text;\r\n    }\r\n    if (!this.options.noStyles) {\r\n      return setStyles(this.elements[element], this.defaultStyles[element]);\r\n    }\r\n  };\r\n\r\n  Heyoffline.prototype.resizeOverlay = function() {\r\n    return setStyles(this.elements.overlay, {\r\n      height: \"\" + window.innerHeight + \"px\"\r\n    });\r\n  };\r\n\r\n  Heyoffline.prototype.destroyElements = function() {\r\n    if (this.elements.overlay) {\r\n      return destroy(this.elements.overlay);\r\n    }\r\n  };\r\n\r\n  Heyoffline.prototype.attachEvents = function() {\r\n    var event, field, _i, _j, _len, _len1, _ref, _ref1,\r\n      _this = this;\r\n    _ref = this.elements.fields;\r\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\r\n      field = _ref[_i];\r\n      this.elementEvents(field);\r\n    }\r\n    _ref1 = this.events.network;\r\n    for (_j = 0, _len1 = _ref1.length; _j < _len1; _j++) {\r\n      event = _ref1[_j];\r\n      this.networkEvents(event);\r\n    }\r\n    return addEvent(window, 'resize', function() {\r\n      return _this.resizeOverlay();\r\n    });\r\n  };\r\n\r\n  Heyoffline.prototype.elementEvents = function(field) {\r\n    var event, _i, _len, _ref, _results,\r\n      _this = this;\r\n    _ref = this.events.element;\r\n    _results = [];\r\n    for (_i = 0, _len = _ref.length; _i < _len; _i++) {\r\n      event = _ref[_i];\r\n      _results.push((function(event) {\r\n        return addEvent(field, event, function() {\r\n          return _this.modified = true;\r\n        });\r\n      })(event));\r\n    }\r\n    return _results;\r\n  };\r\n\r\n  Heyoffline.prototype.networkEvents = function(event) {\r\n    return addEvent(window, event, this[event]);\r\n  };\r\n\r\n  Heyoffline.prototype.online = function(event) {\r\n    return this.hideMessage();\r\n  };\r\n\r\n  Heyoffline.prototype.offline = function() {\r\n    if (this.options.monitorFields) {\r\n      if (this.modified) {\r\n        return this.showMessage();\r\n      }\r\n    } else {\r\n      return this.showMessage();\r\n    }\r\n  };\r\n\r\n  Heyoffline.prototype.showMessage = function() {\r\n    this.createElements();\r\n    if (this.options.onOnline) {\r\n      return this.options.onOnline.call(this);\r\n    }\r\n  };\r\n\r\n  Heyoffline.prototype.hideMessage = function(event) {\r\n    if (event) {\r\n      event.preventDefault();\r\n    }\r\n    this.destroyElements();\r\n    if (this.options.onOffline) {\r\n      return this.options.onOffline.call(this);\r\n    }\r\n  };\r\n\r\n  return Heyoffline;\r\n\r\n})();"]],"start1":0,"start2":0,"length1":0,"length2":6463}]],"length":6463}
