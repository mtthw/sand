<html>
  <head>
    <title>HTMLTIE</title>
    <meta charset="utf-8">
    <script src="codemirror/lib/codemirror.js"></script>
    <script src="codemirror/mode/xml/xml.js"></script>
    <script src="codemirror/mode/javascript/javascript.js"></script>
    <script src="codemirror/mode/css/css.js"></script>
    <link rel="stylesheet" href="codemirror/theme/monokai.css">
    <script src="codemirror/mode/htmlmixed/htmlmixed.js"></script>
    <link rel=stylesheet href="codemirror/lib/codemirror.css">
    <link rel=stylesheet href="codemirror/doc/docs.css">
	<script src="hotkeys.js"></script>
    <style type="text/css">
	  body {
	    max-width: 110%;
		max-height: 110%;
		margin: auto auto auto -16px;
	  }
      .CodeMirror {
        float: left;
        width: 40%;
		height: auto;
        border: 1px solid black;
      }
      #preview {
        width: 58%;
        float: left;
		margin-right: -50px;
        border: 1px solid black;
      }
	#sidebar {
	float: right;
	width: 10px;
	margin-right: -3px;
	}
	#sidebar button {
	width: 20px;
	background-color: white;
	border: 1px solid black;
	border-right: none;
	color: black;
	cursor: pointer;
	margin-left: 3px;
	}
	#sidebar button:hover {
	border-left: 3px solid black;
	}
	#sidebar input[type=text] {
	-webkit-transform: rotate(90deg);
	margin-left: -65px;
	margin-right: -80px;
	border: 1px solid black;
	padding: 2px;
	border-top: none;
	}
	#sidebar input[type=text]:focus {
	outline: none;
	background-color: #000;
	color: #fff;
	}
    </style>
	<script language="JavaScript">
<!--
function calcHeight()
{
  //find the height of the internal page
  var the_height=
    document.getElementById('preview').contentWindow.
      document.body.scrollHeight;

  //change the height of the iframe
  document.getElementById('preview').height=
      the_height;
}
//-->
            function hide(d) {document.querySelector(d).style.display = "none";}
            function show(d) {document.querySelector(d).style.display = "inline";}
			
            function click1() {
			//fullscreen preview
            hide('.CodeMirror');
			show('#preview');
            document.getElementById('preview').style.width = '98%';
            //show('fullscreenOff');
            }
            function click2() {
			//split view
            show('.CodeMirror');
            show('#preview');
            document.getElementById('preview').style.width = '58%';
            document.querySelector('.CodeMirror').style.width = '40%';
            //hide('fullscreenOff');
            }
            function click3() {
			//fullscreen code view
            show('.CodeMirror');
            hide('#preview');
            document.querySelector('.CodeMirror').style.width = '97.83%';
            //show('fullscreenOff');
            }
			
			var cookie = "save";
                        function push() {
                            var cookie = document.getElementById('text').value;
						    editor.setValue('');
							editor.setValue(window.localStorage.getItem(cookie));
						}

                        function save() {
                            var cookie = document.getElementById('text').value;
                            var value = editor.getValue();
							window.localStorage.setItem(cookie, value);
						}
						
			shortcut.add("Esc",function() {
                        click2();
                        });
                        shortcut.add("Ctrl+M",function() {
                        click2();
                        });
                        shortcut.add("Tab",function() {
                        document.getElementById('text').focus();
                        document.getElementById('text').select();
                        });
                        shortcut.add("Shift+Tab",function() {
                        editor.focus();
                        });
                        shortcut.add("Ctrl+.",function() {
                        click3();
                        });
                        shortcut.add("Ctrl+,",function() {
                        click1();
                        });
</script>
  </head>
  <body onload="push()">
	<div id="sidebar">	
	  <button title="Ctrl+," onclick="click1()">&#60;</button><br> 
	  <button title="Ctrl+m or Esc" onclick="click2()">|</button><br>
	  <button title="Ctrl+." onclick="click3()">&#62;</button>
	<br><br><br><br>
	  <input placeholder="Project..." title="Tab / Shift+Tab to return to textarea" id="text" type="text" onkeyup="push()"/>
	</div>
	<textarea autofocus id="code" name="code"></textarea>
    <iframe height="99.5%" id="preview"></iframe>
    <script>
      var delay;
      // Initialize CodeMirror editor with a nice html5 canvas demo.
      var editor = CodeMirror.fromTextArea(document.getElementById('code'), {
        mode: 'text/html',
        tabMode: 'indent',
		lineNumbers: true,
  		lineWrapping: true,
        onChange: function() {
          clearTimeout(delay);
          delay = setTimeout(updatePreview, 300);
        }
      });
      
      function updatePreview() {
        var previewFrame = document.getElementById('preview');
        var preview =  previewFrame.contentDocument ||  previewFrame.contentWindow.document;
        preview.open();
        preview.write(editor.getValue());
        preview.close();
      }
      setTimeout(updatePreview, 300);
    </script>
    <script>
            (function() {

            try {
            (window.localStorage.getItem) // will throw in Firefox under some settings
            } catch (e) {
            return; // quit because dom.storage.enabled is false
            }

            var area = document.querySelector('#text');
            // place content from previous edit
            if (!area.value) {
            area.value = window.localStorage.getItem('project');
            }

            // your content will be saved locally
            document.querySelector('#text').addEventListener('keyup', function() {
            window.localStorage.setItem('project', area.value);
            }, false);
            })();
    </script>
    <script>
	editor.setOption("theme", "monokai");
	editor.setSize(null, "99.5%");
	document.querySelector('.CodeMirror').addEventListener('keyup', function() {
        save();
    }, false);
	</script>
  </body>
</html>
