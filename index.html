<!--<html lang="en" manifest="cache.appcache">-->
<html>
  <head>
    <title>sand</title>
    <!--
     _  _ ___ _  _ _    ___ _ ____ 
     |__|  |  |\/| |     |  | |___ 
     |  |  |  |  | |___  |  | |___   

    -->
    <!-- version 4.8 (frameset) made with <3 by MN -->
    <!-- Open source at http://github.com/mtthw/sand -->

    <!-- Sorry for the messy code, it was kind of hacked together -->
    <link href="favicon.ico" rel="Shortcut Icon" />
    <meta charset="UTF-8">
    <script type="text/javascript">

      var editboxHTML = 
      '<html class="expand close">' +
      '  <head>' +
      '    <script src=codemirror3/lib/codemirror.js></scr' + 'ipt>' +
      '    <script src=codemirror3/mode/xml/xml.js></scr' + 'ipt>' +
      '    <script src=codemirror3/mode/javascript/javascript.js></scr' + 'ipt>' +
      '    <script src=codemirror3/mode/css/css.js></scr' + 'ipt>' +
      '    <script src=codemirror3/mode/htmlmixed/htmlmixed.js></scr' + 'ipt>' +
      '    <script src=codemirror3/addon/selection/mark-selection.js></scr' + 'ipt>' +
      '    <script src=hotkeys.js></scr' + 'ipt>' +

      '    <link rel=stylesheet href=codemirror3/lib/codemirror.css>' +
      '    <link rel=stylesheet href=codemirror3/doc/docs.css>' +
      '    <link rel=stylesheet href=codemirror3/theme/vibrant-ink.css>' +

      '    <script>' +
      '      shortcut.add("Shift+Tab",function() { window.setCookie(); });' +
      '      shortcut.add("Alt+Shift+Tab",function() { var value = editor.getValue(); prompt("Data URI:", "data:text/html, " + value); });' +

      '      function setCookie() {' +
      '        var cookieContent = localStorage.getItem("cookie");' +
      '        var cookie = prompt("Project name:", cookieContent);' +
      '        if (cookie == null) cookie = cookieContent;' +
      '        editor.setValue("");' +
      '        window.localStorage.setItem("cookie", cookie);'+
      '        window.localStorage.setItem("loaded", "false");' +
      '      }' +
      '    </scr' + 'ipt>' +

      '    <style type="text/css">' +
      '      .expand { width: 100%; height: 100%; }' +
      '      .close { border: none; margin: 0px; padding: 0px; }' +
      '      html,body { overflow: hidden; }' +
      '      ::-webkit-scrollbar {' +
      '        width: 5px;' +
      '        height: 5px;' +
      '      }' +
      '      ::-webkit-scrollbar-track {' +
      '        background-color: transparent;' +
      '      }' +
      '      ::-webkit-scrollbar-thumb {' +
      '        background-color: #444;' +
      '        border-radius: 5px;' +
      '        padding-right: 50px;' +
      '      }' +
      '      .CodeMirror-line-numbers {' + 
      '        width: 2.2em;' +
      '        color: #aaa;' +
      '        background-color: #eee;' +
      '        text-align: right;' +
      '        padding-right: .3em;' +
      '        font-size: 10pt;' +
      '        font-family: monospace;' +
      '        padding-top: .4em;' +
      '      }' +
      '      .CodeMirror-scroll {' +
      '        height: auto;' +
      '        overflow: auto;' +
      '      }' +
      '      .CodeMirror-selected  { background-color: blue !important; }' +
      '      .CodeMirror-selectedtext { color: white; }' +
      '      .activeline {background: #222 !important;}' +
      '      .CodeMirror-matchingbracket {background: #555 !important;}' +
      '      span.CodeMirror-matchhighlight { background: #555; }' +
      '      .CodeMirror-focused span.CodeMirror-matchhighlight { background: #555; !important }' +
      '      .cm-tab {' +
      '        background: url(data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAADAAAAAMCAYAAAAkuj5RAAAAQklEQVR42mNgGAWjYEQA5v9AAKQFQBwoe8gBJajDBVE88H+IgqEYA3JQhxsNRQ+A80BhYaH/UM4DIMA4Wp6NAioDADWL2WV1e3w1AAAAAElFTkSuQmCC);' +
      '        background-position: right;' +
      '        background-repeat: no-repeat;' +
      '      }'+
      '    <\/style>' +
      '  <\/head>' +
      '  <body class="expand close">' +
      '    <form class="expand close" name="f">' +
      '      <textarea id=code class="expand close" style="background: #def; font-family: monospace;" name="ta" wrap="hard" spellcheck="false">' +
      '      <\/textarea>' +
      '    <\/form>' +

      '    <script type="text/javascript">' +
      '      var editor = CodeMirror.fromTextArea(document.getElementById("code"), {' +
      '        mode: "text/html",' +
      '        lineNumbers: true,' +
      '        styleSelectedText: true,' +
      '        matchBrackets: true,' +
      '        theme: "vibrant-ink",' +
      '        lineWrapping: true,' +
      '        tabMode: "indent",' +
      '        onCursorActivity: function() {' +
      '          editor.setLineClass(hlLine, null, null);' +
      '          hlLine = editor.setLineClass(editor.getCursor().line, null, "activeline");' +
      '          editor.matchHighlight("CodeMirror-matchhighlight");' +
      '        }' +
      '      });' +

      '      var hlLine = editor.setLineClass(0, "activeline");' +
      '      editor.focus();' +

      '    </scr' + 'ipt>' +

      '  <\/body>' +
      '<\/html>';

      var defaultStuff = '<h1>Welcome to Sand</h1><a href="mailto: nashma4@gmail.com">Support</a><br><a target="_blank" href="http://github.com/mtthw/sand">Source code</a>';

      var old = '';
         
      function init() {
        window.editbox.document.write(editboxHTML);
        window.editbox.document.close();
        window.localStorage.setItem("loaded", "false");
        //window.editbox.document.f.ta.value = defaultStuff;
        setInterval("update()", 100);
        setInterval("saveLocally()", 500);
      }

      function update() {
        if (window.editbox.editor == undefined) return;
        code = window.editbox.editor.getValue();
        var d = dynamicframe.document; 
      
        if (old != code) {
          old = code;
          d.open();
          d.write(old);
          if (dynamicframe.document.title == '') document.title = 'sand';
          else document.title = dynamicframe.document.title;
          if (code == '') d.write(defaultStuff);
          d.close();
        }
      }

      var cookie = ""
      function saveLocally() {
        var cookie = localStorage.getItem('cookie');
        if (localStorage.getItem('loaded') == 'false') {
          code = localStorage.getItem(cookie);
          if (code == null) code = "";
          window.editbox.editor.setValue(code);
          localStorage.setItem('loaded', 'true');
        } else {
          code = window.editbox.editor.getValue();
          localStorage.setItem(cookie, code);
        }
      }

    </script>
  </head>

  <frameset resizable="yes" cols="*, 42%" border="3" onload="init();">
    <frame name="dynamicframe" src="javascript:'';">
    <frame name="editbox" src="javascript:'';">
  </frameset>

</html>
